<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="twitter:card" content="summary_large_image" /><!-- Begin Jekyll SEO tag v2.8.0 -->
<title>1-1. 머신러닝을 위한 주가 데이터셋 생성 | fastpages</title>
<meta name="generator" content="Jekyll v4.1.1" />
<meta property="og:title" content="1-1. 머신러닝을 위한 주가 데이터셋 생성" />
<meta name="author" content="ag-su" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="2022 DS&amp;ML Stock Prediction Project 1. Stock Prediction Part.1 - baseline model" />
<meta property="og:description" content="2022 DS&amp;ML Stock Prediction Project 1. Stock Prediction Part.1 - baseline model" />
<link rel="canonical" href="https://eunsukim06.github.io/blog/stock%20prediction/2022/07/07/stock-dataset.html" />
<meta property="og:url" content="https://eunsukim06.github.io/blog/stock%20prediction/2022/07/07/stock-dataset.html" />
<meta property="og:site_name" content="fastpages" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2022-07-07T00:00:00-05:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="1-1. 머신러닝을 위한 주가 데이터셋 생성" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"ag-su"},"dateModified":"2022-07-07T00:00:00-05:00","datePublished":"2022-07-07T00:00:00-05:00","description":"2022 DS&amp;ML Stock Prediction Project 1. Stock Prediction Part.1 - baseline model","headline":"1-1. 머신러닝을 위한 주가 데이터셋 생성","mainEntityOfPage":{"@type":"WebPage","@id":"https://eunsukim06.github.io/blog/stock%20prediction/2022/07/07/stock-dataset.html"},"url":"https://eunsukim06.github.io/blog/stock%20prediction/2022/07/07/stock-dataset.html"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/blog/assets/css/style.css"><link type="application/atom+xml" rel="alternate" href="https://eunsukim06.github.io/blog/feed.xml" title="fastpages" /><link rel="shortcut icon" type="image/x-icon" href="/blog/images/favicon.ico"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/Primer/15.2.0/primer.css" integrity="sha512-xTz2ys4coGAOz8vuV1NcQBkgVmKhsSEtjbqyMJbBHRplFuvKIUo6xhLHpAyPt9mfR6twHJgn9OgVLuqOvjeBhg==" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.14.0/css/all.min.css" integrity="sha512-1PKOgIY59xJ8Co8+NE6FZ+LOAZKjy+KY8iq0G4B3CyeY6wYHN3yt9PW0XpSriVlkMXe40PTKnXrLnZ9+fkDaog==" crossorigin="anonymous" />

<script>
function wrap_img(fn) {
    if (document.attachEvent ? document.readyState === "complete" : document.readyState !== "loading") {
        var elements = document.querySelectorAll(".post img");
        Array.prototype.forEach.call(elements, function(el, i) {
            if (el.getAttribute("title") && (el.className != "emoji")) {
                const caption = document.createElement('figcaption');
                var node = document.createTextNode(el.getAttribute("title"));
                caption.appendChild(node);
                const wrapper = document.createElement('figure');
                wrapper.className = 'image';
                el.parentNode.insertBefore(wrapper, el);
                el.parentNode.removeChild(el);
                wrapper.appendChild(el);
                wrapper.appendChild(caption);
            }
        });
    } else { document.addEventListener('DOMContentLoaded', fn); }
}
window.onload = wrap_img;
</script>

<script>
    document.addEventListener("DOMContentLoaded", function(){
    // add link icon to anchor tags
    var elem = document.querySelectorAll(".anchor-link")
    elem.forEach(e => (e.innerHTML = '<i class="fas fa-link fa-xs"></i>'));
    });
</script>
</head>
<body><header class="site-header">

  <div class="wrapper"><a class="site-title" rel="author" href="/blog/">fastpages</a><nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger"><a class="page-link" href="/blog/about/">About Me</a><a class="page-link" href="/blog/search/">Search</a><a class="page-link" href="/blog/categories/">Tags</a></div>
      </nav></div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">1-1. 머신러닝을 위한 주가 데이터셋 생성</h1><p class="page-description">2022 DS&ML Stock Prediction Project | 1. Stock Prediction Part.1 - baseline model </p><p class="post-meta post-meta-title"><time class="dt-published" datetime="2022-07-07T00:00:00-05:00" itemprop="datePublished">
        Jul 7, 2022
      </time>• 
          <span itemprop="author" itemscope itemtype="http://schema.org/Person">
            <span class="p-author h-card" itemprop="name">ag-su</span></span>
       • <span class="read-time" title="Estimated read time">
    
    
      14 min read
    
</span></p>

    
      <p class="category-tags"><i class="fas fa-tags category-tags-icon"></i></i> 
      
        <a class="category-tags-link" href="/blog/categories/#Stock Prediction">Stock Prediction</a>
        
      
      </p>
    

    
      
        <div class="pb-5 d-flex flex-justify-center">
          <div class="px-2">

    <a href="https://github.com/eunsukim06/blog/tree/master/_notebooks/2022-07-07-stock-dataset.ipynb" role="button" target="_blank">
<img class="notebook-badge-image" src="/blog/assets/badges/github.svg" alt="View On GitHub">
    </a>
</div>

          <div class="px-2">
    <a href="https://mybinder.org/v2/gh/eunsukim06/blog/master?filepath=_notebooks%2F2022-07-07-stock-dataset.ipynb" target="_blank">
        <img class="notebook-badge-image" src="/blog/assets/badges/binder.svg" alt="Open In Binder"/>
    </a>
</div>

          <div class="px-2">
    <a href="https://colab.research.google.com/github/eunsukim06/blog/blob/master/_notebooks/2022-07-07-stock-dataset.ipynb" target="_blank">
        <img class="notebook-badge-image" src="/blog/assets/badges/colab.svg" alt="Open In Colab"/>
    </a>
</div>
          <div class="px-2">
  <a href="https://deepnote.com/launch?url=https%3A%2F%2Fgithub.com%2Feunsukim06%2Fblog%2Fblob%2Fmaster%2F_notebooks%2F2022-07-07-stock-dataset.ipynb" target="_blank">
      <img class="notebook-badge-image" src="/blog/assets/badges/deepnote.svg" alt="Launch in Deepnote"/>
  </a>
</div>

        </div>
      </header>

  <div class="post-content e-content" itemprop="articleBody">
    <ul id="toc" class="section-nav">
<li class="toc-entry toc-h1"><a href="#1.-Stock-Prediction-Part.1---baseline-model">1. Stock Prediction Part.1 - baseline model </a>
<ul>
<li class="toc-entry toc-h2"><a href="#1-1.-머신러닝을-위한-주가-데이터셋-생성">1-1. 머신러닝을 위한 주가 데이터셋 생성 </a>
<ul>
<li class="toc-entry toc-h3"><a href="#데이터셋-정의">데이터셋 정의 </a></li>
<li class="toc-entry toc-h3"><a href="#데이터셋-생성-과제">데이터셋 생성 과제 </a></li>
<li class="toc-entry toc-h3"><a href="#목차">목차 </a></li>
<li class="toc-entry toc-h3"><a href="#필요-라이브러리-import">필요 라이브러리 import </a></li>
</ul>
</li>
<li class="toc-entry toc-h2"><a href="#✔️-(0)-Finance-Data-Reader를-이용한-주가-데이터셋---DataFrame">✔️ (0) Finance Data Reader를 이용한 주가 데이터셋 - DataFrame </a></li>
<li class="toc-entry toc-h2"><a href="#✔️-(1)-Finance-Data-Reader를-이용한-주가-데이터셋---df2list">✔️ (1) Finance Data Reader를 이용한 주가 데이터셋 - df2list </a></li>
<li class="toc-entry toc-h2"><a href="#✔️-(2)-Finance-Data-Reader를-이용한-주가-데이터셋---dictionary">✔️ (2) Finance Data Reader를 이용한 주가 데이터셋 - dictionary </a></li>
<li class="toc-entry toc-h2"><a href="#✔️-(3)-Finance-Data-Reader를-이용한-주가-데이터셋---MultiProcessing">✔️ (3) Finance Data Reader를 이용한 주가 데이터셋 - MultiProcessing </a>
<ul>
<li class="toc-entry toc-h3"><a href="#✔️-(4)-Finance-Data-Reader를-이용한-주가-데이터셋---MySQL">✔️ (4) Finance Data Reader를 이용한 주가 데이터셋 - MySQL </a></li>
<li class="toc-entry toc-h3"><a href="#✔️-(5)-최종-머신러닝-데이터셋">✔️ (5) 최종 머신러닝 데이터셋 </a></li>
</ul>
</li>
</ul>
</li>
</ul><!--
#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: _notebooks/2022-07-07-stock-dataset.ipynb
-->

<div class="container" id="notebook-container">
        
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="1.-Stock-Prediction-Part.1---baseline-model">
<a class="anchor" href="#1.-Stock-Prediction-Part.1---baseline-model" aria-hidden="true"><span class="octicon octicon-link"></span></a>1. Stock Prediction Part.1 - baseline model<a class="anchor-link" href="#1.-Stock-Prediction-Part.1---baseline-model"> </a>
</h1>
<h2 id="1-1.-머신러닝을-위한-주가-데이터셋-생성">
<a class="anchor" href="#1-1.-%EB%A8%B8%EC%8B%A0%EB%9F%AC%EB%8B%9D%EC%9D%84-%EC%9C%84%ED%95%9C-%EC%A3%BC%EA%B0%80-%EB%8D%B0%EC%9D%B4%ED%84%B0%EC%85%8B-%EC%83%9D%EC%84%B1" aria-hidden="true"><span class="octicon octicon-link"></span></a>1-1. 머신러닝을 위한 주가 데이터셋 생성<a class="anchor-link" href="#1-1.-%EB%A8%B8%EC%8B%A0%EB%9F%AC%EB%8B%9D%EC%9D%84-%EC%9C%84%ED%95%9C-%EC%A3%BC%EA%B0%80-%EB%8D%B0%EC%9D%B4%ED%84%B0%EC%85%8B-%EC%83%9D%EC%84%B1"> </a>
</h2>
<p>주가 데이터셋 생성 절차는 <code>df2list</code> - <code>dictionary</code> - <code>MultiProcessing</code> - <code>MySQL</code> 순서로 진행한다. 4가지 절차를 통해 데이터셋이 달라지는 것은 아니고, 속도를 개선시키는 방향으로의 효율적인 코드를 짜기 위한 훈련 과정이다. 대규모 데이터셋을 다루기 위해서는 효율적인 코딩을 통해 속도를 개선하는 것도 중요한 일이다. 특히 이번에 사용하는 주가 데이터셋은 양이 많을 뿐만 아니라, <code>fdr</code> 라이브러리를 사용하여 외부에서 불러와야하기 때문에 데이터셋을 구성하는 것만 해도 속도가 상당히 느리다. 이러한 문제점을 해결하고자 본 포스팅에서는 4단계에 걸친 데이터셋 생성 과정을 보여준다.</p>
<p><br></p>
<h3 id="데이터셋-정의">
<a class="anchor" href="#%EB%8D%B0%EC%9D%B4%ED%84%B0%EC%85%8B-%EC%A0%95%EC%9D%98" aria-hidden="true"><span class="octicon octicon-link"></span></a>데이터셋 정의<a class="anchor-link" href="#%EB%8D%B0%EC%9D%B4%ED%84%B0%EC%85%8B-%EC%A0%95%EC%9D%98"> </a>
</h3>
<ul>
<li>
<strong><code>조건</code></strong>: 전체 약 2000개 종목 중 2018년 부터 존속하였던 기업 중 거래대금이 1000억 이상 발생한 날짜 (거래대금은 추후에 수정 가능) </li>
<li>
<strong><code>column</code></strong>: <strong><code>조건</code></strong> 에서 선별한 특정 날짜를 D0라고 했을 때, D-9, D-8, ..., D0, 총 10일 치의 <code>Open</code>, <code>High</code>, <code>Low</code>, <code>Close</code>, <code>거래대금(trading_value)</code> </li>
<li>
<strong><code>label</code></strong>:  조건에 부합하는 특정 날짜(D0) 대비 다음날(D+1) 날짜의 종가(close)가 2%이상 상승하면 <code>1</code>, 상승하지 않으면 <code>0</code>
</li>
<li>
<strong><code>train dataset</code></strong>: 2018년 1월 2일 - 2020년 12월 31일 (2년)</li>
<li>
<strong><code>test dataset</code></strong>: 2021년 1월 2일 ~ 2021년 6월 31일 (6개월)</li>
</ul>
<p><br></p>
<h3 id="데이터셋-생성-과제">
<a class="anchor" href="#%EB%8D%B0%EC%9D%B4%ED%84%B0%EC%85%8B-%EC%83%9D%EC%84%B1-%EA%B3%BC%EC%A0%9C" aria-hidden="true"><span class="octicon octicon-link"></span></a>데이터셋 생성 과제<a class="anchor-link" href="#%EB%8D%B0%EC%9D%B4%ED%84%B0%EC%85%8B-%EC%83%9D%EC%84%B1-%EA%B3%BC%EC%A0%9C"> </a>
</h3>
<p>데이터셋 생성을 총 3가지 과제로 나누어 진행한다.</p>
<ul>
<li>
<strong><code>과제 I</code></strong>: 종목 리스트 생성-2018년 부터 존속하였던 기업(상장일 2018년 1월 1일 이전 기업)  선별</li>
<li>
<strong><code>과제 II</code></strong>: <strong><code>과제I</code></strong> 의 기업 중 거래대금이 1000억 이상 발생했던 특정 날짜 선별 (<code>거래대금</code>=<code>거래량</code>X<code>종가</code> 로 계산)</li>
<li>
<strong><code>과제 III</code></strong>: <strong><code>과제II</code></strong> 의 날짜에 대해 최종 머신러닝 데이터 생성</li>
</ul>
<p><br></p>
<h3 id="목차">
<a class="anchor" href="#%EB%AA%A9%EC%B0%A8" aria-hidden="true"><span class="octicon octicon-link"></span></a>목차<a class="anchor-link" href="#%EB%AA%A9%EC%B0%A8"> </a>
</h3>
<ul>
<li>
<strong>(0)</strong> Finance Data Reader를 이용한 주가 데이터셋 - <code>DataFrame</code>
</li>
<li>
<strong>(1)</strong> Finance Data Reader를 이용한 주가 데이터셋 - <code>df2list</code>
</li>
<li>
<strong>(2)</strong> Finance Data Reader를 이용한 주가 데이터셋 - <code>dictionary</code>
</li>
<li>
<strong>(3)</strong> Finance Data Reader를 이용한 주가 데이터셋 - <code>MultiProcessing</code>
</li>
<li>
<strong>(4)</strong> Finance Data Reader를 이용한 주가 데이터셋 - <code>MySQL</code>
</li>
<li>
<strong>(5)</strong> 최종 머신러닝 데이터셋 </li>
</ul>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="필요-라이브러리-import">
<a class="anchor" href="#%ED%95%84%EC%9A%94-%EB%9D%BC%EC%9D%B4%EB%B8%8C%EB%9F%AC%EB%A6%AC-import" aria-hidden="true"><span class="octicon octicon-link"></span></a>필요 라이브러리 <strong>import</strong><a class="anchor-link" href="#%ED%95%84%EC%9A%94-%EB%9D%BC%EC%9D%B4%EB%B8%8C%EB%9F%AC%EB%A6%AC-import"> </a>
</h3>
</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># ! pip install -U finance-datareader</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">from</span> <span class="nn">tqdm</span> <span class="kn">import</span> <span class="n">tqdm</span>
<span class="kn">import</span> <span class="nn">FinanceDataReader</span> <span class="k">as</span> <span class="nn">fdr</span>
<span class="kn">import</span> <span class="nn">time</span>

<span class="c1"># 경고 메시지 무시 </span>
<span class="kn">import</span> <span class="nn">warnings</span>
<span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span><span class="n">action</span><span class="o">=</span><span class="s1">'ignore'</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="✔️-(0)-Finance-Data-Reader를-이용한-주가-데이터셋---DataFrame">
<a class="anchor" href="#%E2%9C%94%EF%B8%8F-(0)-Finance-Data-Reader%EB%A5%BC-%EC%9D%B4%EC%9A%A9%ED%95%9C-%EC%A3%BC%EA%B0%80-%EB%8D%B0%EC%9D%B4%ED%84%B0%EC%85%8B---DataFrame" aria-hidden="true"><span class="octicon octicon-link"></span></a>✔️ <strong>(0)</strong> Finance Data Reader를 이용한 주가 데이터셋 - <code>DataFrame</code><a class="anchor-link" href="#%E2%9C%94%EF%B8%8F-(0)-Finance-Data-Reader%EB%A5%BC-%EC%9D%B4%EC%9A%A9%ED%95%9C-%EC%A3%BC%EA%B0%80-%EB%8D%B0%EC%9D%B4%ED%84%B0%EC%85%8B---DataFrame"> </a>
</h2>
<p>속도 비교를 위해 기존 데이터의 타입인 <code>DataFrame</code>을 사용하여 데이터셋을 생성한다. 연구 인턴 초기 첫번째로 작성했던 코드들인데, 개선해야 할 부분들이 많다.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><strong>과제 I</strong></p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_html</span><span class="p">(</span><span class="s1">'http://kind.krx.co.kr/corpgeneral/corpList.do?method=download'</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="mi">0</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

<span class="c1"># 회사명, 종목코드, 상장일 컬럼만 사용 </span>
<span class="n">df_code</span> <span class="o">=</span> <span class="n">df</span><span class="p">[[</span><span class="s1">'회사명'</span><span class="p">,</span> <span class="s1">'종목코드'</span><span class="p">,</span> <span class="s1">'상장일'</span><span class="p">]]</span>

<span class="c1"># 종목코드를 6자리로 맞춰 준다. </span>
<span class="n">df_code</span><span class="p">[</span><span class="s1">'종목코드'</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_code</span><span class="p">[</span><span class="s1">'종목코드'</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span> <span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">.</span><span class="n">zfill</span><span class="p">(</span><span class="mi">6</span><span class="p">))</span>
<span class="n">display</span><span class="p">(</span><span class="n">df_code</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">3</span><span class="p">))</span>
<span class="nb">print</span><span class="p">()</span>

<span class="c1"># 상장일이 2018년 1월 1일 이전인 종목코드 선별 </span>
<span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
<span class="n">lst_code</span> <span class="o">=</span> <span class="n">df_code</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df_code</span><span class="p">[</span><span class="s1">'상장일'</span><span class="p">]</span> <span class="o">&lt;</span> <span class="s1">'2018-01-01'</span><span class="p">,</span> <span class="s1">'종목코드'</span><span class="p">]</span><span class="o">.</span><span class="n">to_list</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">"걸린 시간: "</span><span class="p">,</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">start_time</span><span class="p">)</span>
<span class="nb">print</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">'상장일 2018-01-01 이전 종목코드: '</span><span class="p">,</span> <span class="n">lst_code</span><span class="p">[:</span><span class="mi">5</span><span class="p">])</span>
<span class="nb">print</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">'총 </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">df_code</span><span class="p">)</span><span class="si">}</span><span class="s1"> 개의 종목 중 </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">lst_code</span><span class="p">)</span><span class="si">}</span><span class="s1"> 개의 종목 선별'</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea ">
<div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>회사명</th>
      <th>종목코드</th>
      <th>상장일</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>DL</td>
      <td>000210</td>
      <td>1976-02-02</td>
    </tr>
    <tr>
      <th>1</th>
      <td>DRB동일</td>
      <td>004840</td>
      <td>1976-05-21</td>
    </tr>
    <tr>
      <th>2</th>
      <td>DSR</td>
      <td>155660</td>
      <td>2013-05-15</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>
걸린 시간:  0.0006933212280273438

상장일 2018-01-01 이전 종목코드:  ['000210', '004840', '155660', '078930', '001390']

총 2507 개의 종목 중 1977 개의 종목 선별
</pre>
</div>
</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><strong>과제 II</strong></p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">stock_dict</span> <span class="o">=</span> <span class="p">{}</span>
<span class="k">for</span> <span class="n">code</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="n">lst_code</span><span class="p">):</span> 
    <span class="n">stock</span> <span class="o">=</span> <span class="n">fdr</span><span class="o">.</span><span class="n">DataReader</span><span class="p">(</span><span class="n">code</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="s1">'20180101'</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s1">'20201231'</span><span class="p">)</span>
    <span class="n">stock</span><span class="p">[</span><span class="s1">'trading'</span><span class="p">]</span> <span class="o">=</span> <span class="n">stock</span><span class="p">[</span><span class="s1">'Volume'</span><span class="p">]</span> <span class="o">*</span> <span class="n">stock</span><span class="p">[</span><span class="s1">'Close'</span><span class="p">]</span> <span class="c1"># 거래대금 컬럼 추가</span>
    
    <span class="k">if</span> <span class="nb">sum</span><span class="p">(</span><span class="n">stock</span><span class="p">[</span><span class="s1">'trading'</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mi">100000000000</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">1</span><span class="p">:</span> <span class="c1"># 거래대금이 1000억 이상인 데이터가 하나 이상 존재하면</span>
        <span class="n">stock_dict</span><span class="p">[</span><span class="n">code</span><span class="p">]</span> <span class="o">=</span> <span class="n">stock</span><span class="p">[</span><span class="n">stock</span><span class="p">[</span><span class="s1">'trading'</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mi">100000000000</span><span class="p">]</span><span class="o">.</span><span class="n">index</span> 

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">'총 </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">lst_code</span><span class="p">)</span><span class="si">}</span><span class="s1"> 개의 종목 중 </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">stock_dict</span><span class="p">)</span><span class="si">}</span><span class="s1"> 개의 종목 사용'</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>100%|██████████████████████████████████████████████| 1977/1977 [02:58&lt;00:00, 11.08it/s]</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>총 1977 개의 종목 중 799 개의 종목 사용
</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>
</pre>
</div>
</div>

</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">lst_code_date</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">code</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="n">stock_dict</span><span class="p">):</span> 
    <span class="k">for</span> <span class="n">date</span> <span class="ow">in</span> <span class="p">(</span><span class="n">stock_dict</span><span class="p">[</span><span class="n">code</span><span class="p">]):</span>
        <span class="n">lst_code_date</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">code</span><span class="p">,</span> <span class="n">date</span><span class="p">])</span>
        
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">'선별된 날짜는 총 </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">lst_code_date</span><span class="p">)</span><span class="si">}</span><span class="s1">개'</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>100%|█████████████████████████████████████████████| 799/799 [00:00&lt;00:00, 13125.89it/s]</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>선별된 날짜는 총 14182개
</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>
</pre>
</div>
</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><strong>과제 III</strong></p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">data_dict</span> <span class="o">=</span> <span class="p">{</span><span class="s1">'code'</span><span class="p">:</span> <span class="p">[],</span> <span class="s1">'d0'</span><span class="p">:</span> <span class="p">[],</span> <span class="s1">'info'</span><span class="p">:</span> <span class="p">[],</span> <span class="s1">'up'</span><span class="p">:</span> <span class="p">[]}</span>
<span class="k">for</span> <span class="n">code</span><span class="p">,</span> <span class="n">date</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="n">lst_code_date</span><span class="p">):</span>
    <span class="n">start_date</span> <span class="o">=</span> <span class="s1">'20171201'</span> <span class="c1"># 2018년 초반 날짜가 D0라면 2017년 데이터 필요 (D-9~D-1)</span>
    <span class="n">end_date</span> <span class="o">=</span> <span class="s1">'20210130'</span> <span class="c1"># 2020년 후반 날짜가 D0라면 2021년 데이터 필요 (D+1) </span>
    <span class="n">stock</span> <span class="o">=</span> <span class="n">fdr</span><span class="o">.</span><span class="n">DataReader</span><span class="p">(</span><span class="n">code</span><span class="p">,</span> <span class="n">start</span> <span class="o">=</span> <span class="n">start_date</span><span class="p">,</span> <span class="n">end</span> <span class="o">=</span> <span class="n">end_date</span><span class="p">)</span>
    <span class="n">stock</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="c1"># 'Date' index -&gt; column </span>
    
    <span class="n">D9_index</span> <span class="o">=</span> <span class="n">stock</span><span class="p">[</span><span class="n">stock</span><span class="p">[</span><span class="s1">'Date'</span><span class="p">]</span> <span class="o">==</span> <span class="nb">str</span><span class="p">(</span><span class="n">date</span><span class="p">)]</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="mi">9</span> <span class="c1"># D-9 날짜의 인덱스  </span>
    <span class="n">next_index</span> <span class="o">=</span> <span class="n">stock</span><span class="p">[</span><span class="n">stock</span><span class="p">[</span><span class="s1">'Date'</span><span class="p">]</span> <span class="o">==</span> <span class="nb">str</span><span class="p">(</span><span class="n">date</span><span class="p">)]</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span> <span class="c1"># D+1 날짜의 인덱스  </span>
        
    <span class="c1"># 종목코드 (code)</span>
    <span class="n">data_dict</span><span class="p">[</span><span class="s1">'code'</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">code</span><span class="p">)</span> 
    
    <span class="c1"># 기준일 (d0)</span>
    <span class="n">data_dict</span><span class="p">[</span><span class="s1">'d0'</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">date</span><span class="p">)</span>
    
    <span class="c1"># D-9 ~ D+1, 총 11일치의 sub stock DataFrame 생성 </span>
    <span class="n">sub_stock</span> <span class="o">=</span> <span class="n">stock</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">D9_index</span><span class="p">:</span><span class="n">next_index</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">sub_stock</span><span class="p">[</span><span class="s1">'trading'</span><span class="p">]</span> <span class="o">=</span> <span class="n">sub_stock</span><span class="p">[</span><span class="s1">'Close'</span><span class="p">]</span> <span class="o">*</span> <span class="n">sub_stock</span><span class="p">[</span><span class="s1">'Volume'</span><span class="p">]</span> <span class="c1"># 거래대금 컬럼 추가 </span>
   
    
    <span class="c1"># 10일 간의 데이터 (info)</span>
    <span class="n">info_list</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">):</span>        
        <span class="n">info_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sub_stock</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">]]</span><span class="o">.</span><span class="n">to_list</span><span class="p">())</span>
    <span class="n">remove_list</span><span class="o">=</span><span class="p">[</span><span class="s1">'['</span><span class="p">,</span> <span class="s1">']'</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">):</span> 
        <span class="n">info_list</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">'</span><span class="si">{</span><span class="n">info_list</span><span class="si">}</span><span class="s1">'</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">remove_list</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="s1">''</span><span class="p">)</span>
    <span class="n">data_dict</span><span class="p">[</span><span class="s1">'info'</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">info_list</span><span class="p">)</span>    
        
        
    <span class="c1"># D+1 종가 2% 상승 여부 (up)</span>
    <span class="n">up</span> <span class="o">=</span> <span class="n">sub_stock</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">][</span><span class="s1">'Close'</span><span class="p">]</span> <span class="o">+</span> <span class="mf">0.02</span> <span class="o">*</span> <span class="n">sub_stock</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">][</span><span class="s1">'Close'</span><span class="p">]</span>
    
    <span class="k">if</span> <span class="n">sub_stock</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="s1">'Close'</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">up</span><span class="p">:</span> 
        <span class="n">data_dict</span><span class="p">[</span><span class="s1">'up'</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span> 
        <span class="n">data_dict</span><span class="p">[</span><span class="s1">'up'</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>100%|████████████████████████████████████████████| 14182/14182 [17:08&lt;00:00, 13.78it/s]
</pre>
</div>
</div>

</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">df_result</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data_dict</span><span class="p">)</span>
<span class="n">display</span><span class="p">(</span><span class="n">df_result</span><span class="o">.</span><span class="n">head</span><span class="p">())</span> 

<span class="c1"># 최종 결과 데이터셋 txt 파일 저장 </span>
<span class="n">df_result</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s2">"assignment3.txt"</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">'생성된 데이터의 개수는 </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">"assignment3.txt"</span><span class="p">))</span><span class="si">}</span><span class="s1"> 개'</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea ">
<div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>code</th>
      <th>d0</th>
      <th>info</th>
      <th>up</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>000210</td>
      <td>2018-01-26</td>
      <td>78343, 78614, 76987, 77892, 9590608284, 77801,...</td>
      <td>0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>000210</td>
      <td>2018-08-08</td>
      <td>68855, 69397, 67590, 69036, 6067435968, 69487,...</td>
      <td>0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>000210</td>
      <td>2020-04-02</td>
      <td>44819, 52951, 44322, 51145, 15615437965, 47439...</td>
      <td>0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>000210</td>
      <td>2020-09-11</td>
      <td>80783, 84487, 78524, 78524, 61554885076, 79608...</td>
      <td>0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>000210</td>
      <td>2020-12-11</td>
      <td>76174, 76174, 72289, 72289, 76043112348, 72831...</td>
      <td>0</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>생성된 데이터의 개수는 14182 개
</pre>
</div>
</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><strong>개선해야할 사항</strong></p>
<ul>
<li>
<strong><code>속도 개선</code></strong>: <strong><code>과제III</code></strong> 은 약 17분이 걸린 것을 보아 속도 면에서 상당히 비효율적이었다는 것을 알 수 있다. (거래대금을 10억으로 설정했을 때 1% 진행에 5분이 걸렸다. 그럼 총 500분이 걸릴 것으로 예상할 수 있다.)</li>
</ul>
<ul>
<li>
<strong><code># 10일 간의 데이터</code></strong> 부분: <code>info_list</code>에 데이터를 추가하는 과정에서 억지로 포맷을 맞추기 위해 불필요한 <code>for문</code>이 들어갔다. </li>
</ul>
<ul>
<li>
<strong><code># D+1 종가 2% 상승 여부</code></strong> 부분: 전 날 대비 2% 상승율을 직접 계산해 주었는데, 이미 변화율이 계산 되어 있는 <code>change</code>라는 컬럼을 사용하는 것으로 대체한다. </li>
</ul>
<ul>
<li>
<strong><code>txt 파일 저장</code></strong>: <code>DataFrame</code>으로 생성을 한 후에 <code>txt</code> 파일로 저장했는데, 데이터 생성 시 파일 입출력 <code>write()</code>를 사용해서 바로 <code>txt</code> 파일로  저장하는 방식으로 변경한다. </li>
</ul>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<hr>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="✔️-(1)-Finance-Data-Reader를-이용한-주가-데이터셋---df2list">
<a class="anchor" href="#%E2%9C%94%EF%B8%8F-(1)-Finance-Data-Reader%EB%A5%BC-%EC%9D%B4%EC%9A%A9%ED%95%9C-%EC%A3%BC%EA%B0%80-%EB%8D%B0%EC%9D%B4%ED%84%B0%EC%85%8B---df2list" aria-hidden="true"><span class="octicon octicon-link"></span></a>✔️ (1) Finance Data Reader를 이용한 주가 데이터셋 - <code>df2list</code><a class="anchor-link" href="#%E2%9C%94%EF%B8%8F-(1)-Finance-Data-Reader%EB%A5%BC-%EC%9D%B4%EC%9A%A9%ED%95%9C-%EC%A3%BC%EA%B0%80-%EB%8D%B0%EC%9D%B4%ED%84%B0%EC%85%8B---df2list"> </a>
</h2>
<p>첫번째 방법은 <code>DataFrame</code> 사용을 지양하고, <code>python</code>의 기본 데이터 타입인 <code>list</code>로 바꾸어 사용하는 방법이다. 이로써 <code>column</code> 중심의 연산을 <code>row</code> 중심의 연산으로 바꾸어준다. 이 방법에서는 속도 개선 보다는 <code>(0)</code>번 방법의 코드에서 효율적이지 못했던 부분을 고치고 깔끔한 코드로 보완한다.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><strong>과제 I</strong></p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">display</span><span class="p">(</span><span class="n">df_code</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span>

<span class="c1"># 🌟 dataframe -&gt; list </span>
<span class="n">lst_stock</span> <span class="o">=</span> <span class="n">df_code</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="n">lst_stock</span><span class="p">[:</span><span class="mi">2</span><span class="p">])</span>
<span class="nb">print</span><span class="p">()</span>


<span class="n">lst_code</span> <span class="o">=</span> <span class="p">[]</span> <span class="c1"># 선별 된 코드를 담을 리스트 </span>
<span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
<span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">lst_stock</span><span class="p">:</span>
    <span class="n">code</span><span class="p">,</span> <span class="n">date</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">row</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">date</span> <span class="o">&lt;=</span> <span class="s1">'2018-01-01'</span><span class="p">:</span>
        <span class="n">lst_code</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">code</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">"걸린 시간: "</span><span class="p">,</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">start_time</span><span class="p">)</span>
<span class="nb">print</span><span class="p">()</span>

        
<span class="nb">print</span><span class="p">(</span><span class="s1">'상장일 2018-01-01 이전 종목코드: '</span><span class="p">,</span> <span class="n">lst_code</span><span class="p">[:</span><span class="mi">4</span><span class="p">])</span>
<span class="nb">print</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">'총 </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">df_code</span><span class="p">)</span><span class="si">}</span><span class="s1"> 개의 종목 중 </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">lst_code</span><span class="p">)</span><span class="si">}</span><span class="s1"> 개의 종목 선별'</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea ">
<div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>회사명</th>
      <th>종목코드</th>
      <th>상장일</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>DL</td>
      <td>000210</td>
      <td>1976-02-02</td>
    </tr>
    <tr>
      <th>1</th>
      <td>DRB동일</td>
      <td>004840</td>
      <td>1976-05-21</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>[['DL', '000210', '1976-02-02'], ['DRB동일', '004840', '1976-05-21']]

걸린 시간:  0.0004284381866455078

상장일 2018-01-01 이전 종목코드:  ['000210', '004840', '155660', '078930']

총 2507 개의 종목 중 1977 개의 종목 선별
</pre>
</div>
</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><strong>과제 II</strong></p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">lst_code_date</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">code</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="n">lst_code</span><span class="p">):</span>
    <span class="n">stock</span> <span class="o">=</span> <span class="n">fdr</span><span class="o">.</span><span class="n">DataReader</span><span class="p">(</span><span class="n">code</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="s1">'20180102'</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s1">'20201231'</span><span class="p">)</span>
    <span class="n">stock</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    
    <span class="c1"># 🌟 dataframe -&gt; list </span>
    <span class="n">lst_stock</span> <span class="o">=</span> <span class="n">stock</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
    
    <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">lst_stock</span><span class="p">:</span> 
        <span class="n">date</span><span class="p">,</span> <span class="n">trading_value</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">row</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span><span class="o">*</span><span class="n">row</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">trading_value</span> <span class="o">&gt;=</span> <span class="mi">100000000000</span><span class="p">:</span>  <span class="c1"># 거래대금 1000억 이상</span>
            <span class="n">lst_code_date</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">code</span><span class="p">,</span> <span class="n">date</span><span class="o">.</span><span class="n">date</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">"%Y%m</span><span class="si">%d</span><span class="s2">"</span><span class="p">)])</span>
            
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">'선별된 날짜는 총 </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">lst_code_date</span><span class="p">)</span><span class="si">}</span><span class="s1">개'</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>100%|██████████████████████████████████████████████| 1977/1977 [02:55&lt;00:00, 11.26it/s]</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>선별된 날짜는 총 14182개
</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>
</pre>
</div>
</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><strong>과제 III</strong></p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">OF</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s1">'assignment3.txt'</span><span class="p">,</span><span class="s1">'w'</span><span class="p">)</span>

<span class="k">for</span> <span class="n">code</span><span class="p">,</span> <span class="n">date</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="n">lst_code_date</span><span class="p">):</span>
    <span class="n">start_date</span> <span class="o">=</span> <span class="s1">'20180101'</span> 
    <span class="n">end_date</span> <span class="o">=</span> <span class="s1">'20201231'</span> 
    <span class="n">stock</span> <span class="o">=</span> <span class="n">fdr</span><span class="o">.</span><span class="n">DataReader</span><span class="p">(</span><span class="n">code</span><span class="p">,</span> <span class="n">start</span> <span class="o">=</span> <span class="n">start_date</span><span class="p">,</span> <span class="n">end</span> <span class="o">=</span> <span class="n">end_date</span><span class="p">)</span>
    <span class="n">stock</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="c1"># 'Date' index -&gt; column </span>
    
    
    <span class="c1"># 🌟 dataframe -&gt; list </span>
    <span class="n">lst_stock</span> <span class="o">=</span> <span class="n">stock</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
    
    
    <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">lst_stock</span><span class="p">):</span> 
        <span class="k">if</span> <span class="p">(</span><span class="n">idx</span> <span class="o">&lt;</span> <span class="mi">9</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">idx</span> <span class="o">&gt;=</span> <span class="nb">len</span><span class="p">(</span><span class="n">lst_stock</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span> <span class="c1"># 예외 처리 </span>
            <span class="k">continue</span> 
        
        <span class="k">if</span> <span class="n">row</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">date</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">"%Y%m</span><span class="si">%d</span><span class="s2">"</span><span class="p">)</span> <span class="o">==</span> <span class="n">date</span><span class="p">:</span> 
            
            <span class="c1"># D-9 ~ D0 데이터만 담기</span>
            <span class="n">sub_stock</span> <span class="o">=</span> <span class="n">lst_stock</span><span class="p">[</span><span class="n">idx</span><span class="o">-</span><span class="mi">9</span><span class="p">:</span><span class="n">idx</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span>
            
            <span class="c1"># 10일 간의 데이터 </span>
            <span class="n">lst_info</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">row2</span> <span class="ow">in</span> <span class="n">sub_stock</span><span class="p">:</span>
                <span class="n">lst_prices</span><span class="p">,</span> <span class="n">trading_value</span> <span class="o">=</span> <span class="n">row2</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="mi">5</span><span class="p">],</span> <span class="n">row</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span><span class="o">*</span><span class="n">row</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span>
                <span class="n">lst_info</span> <span class="o">+=</span> <span class="n">lst_prices</span> <span class="o">+</span> <span class="p">[</span><span class="n">trading_value</span><span class="p">]</span>
                
            <span class="n">info</span> <span class="o">=</span> <span class="s1">','</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">lst_info</span><span class="p">))</span>
            
            <span class="c1"># D+1 종가 2% 상승 여부 (up)</span>
            <span class="n">change</span> <span class="o">=</span> <span class="n">lst_stock</span><span class="p">[</span><span class="n">idx</span><span class="o">+</span><span class="mi">1</span><span class="p">][</span><span class="mi">6</span><span class="p">]</span>
            <span class="n">label</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">change</span> <span class="o">&gt;=</span> <span class="mf">0.02</span><span class="p">)</span>
            
            <span class="c1"># 저장 </span>
            <span class="n">OF</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s1">'</span><span class="si">{</span><span class="n">code</span><span class="si">}</span><span class="se">\t</span><span class="si">{</span><span class="n">date</span><span class="si">}</span><span class="se">\t</span><span class="si">{</span><span class="n">lst_info</span><span class="si">}</span><span class="se">\t</span><span class="si">{</span><span class="n">label</span><span class="si">}</span><span class="se">\n</span><span class="s1">'</span><span class="p">)</span>
            
<span class="n">OF</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">'생성된 데이터의 개수는 </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">"assignment3.txt"</span><span class="p">))</span><span class="si">}</span><span class="s1"> 개'</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>100%|████████████████████████████████████████████| 14182/14182 [17:43&lt;00:00, 13.33it/s]</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>생성된 데이터의 개수는 13939 개
</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>
</pre>
</div>
</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<ul>
<li>
<code>OF.write()</code>를 사용함으로써 블필요한 <code>DataFrame</code> 을 생성하지 않는다.</li>
</ul>
<ul>
<li>
<strong># 10일간의 데이터</strong> 부분은 <code>join()</code> 함수를 사용하여 불필요한 for문 사용을 줄였고, <strong># D+1 종가 2% 상승 여부 (up)</strong> 부분은 전날 대비 종가 변화율을 계산하지 않고 <code>change</code> 컬럼을 활용하는 것으로 바꾸었다. </li>
</ul>
<ul>
<li>
<strong><code>속도에 대한 문제점</code></strong> : 전 보다 깔끔한 코드로 보완이 되었지만, 아직 속도에 대한 문제점이 남아있다. 속도를 개선하기 위해서는 <code>fdr</code> 라이브러리를 최소한으로 사용해야 한다. 이를 해결하기 위해 <code>dictionary</code>를 사용하는 방법으로 넘어간다. </li>
</ul>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<hr>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="✔️-(2)-Finance-Data-Reader를-이용한-주가-데이터셋---dictionary">
<a class="anchor" href="#%E2%9C%94%EF%B8%8F-(2)-Finance-Data-Reader%EB%A5%BC-%EC%9D%B4%EC%9A%A9%ED%95%9C-%EC%A3%BC%EA%B0%80-%EB%8D%B0%EC%9D%B4%ED%84%B0%EC%85%8B---dictionary" aria-hidden="true"><span class="octicon octicon-link"></span></a>✔️ (2) Finance Data Reader를 이용한 주가 데이터셋 - <code>dictionary</code><a class="anchor-link" href="#%E2%9C%94%EF%B8%8F-(2)-Finance-Data-Reader%EB%A5%BC-%EC%9D%B4%EC%9A%A9%ED%95%9C-%EC%A3%BC%EA%B0%80-%EB%8D%B0%EC%9D%B4%ED%84%B0%EC%85%8B---dictionary"> </a>
</h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><code>dictionary</code>를 사용하는 방법은 <strong><code>과제III</code></strong> 의 속도를 개선한다. <code>fdr</code> 라이브러리를 최소한으로 사용하고, <code>for</code>문을 최대한 줄인다. 현재 문제점은 날짜를 기준으로 <code>for</code>문이 돌아가기 때문에 같은 데이터(같은 종목)가 여러번 불러와지는 경우가 다수 존재한다는 것이다. 따라서 <strong><code>과제II</code></strong> 에서 <code>code</code>별 <code>D0</code> 날짜 리스트를 <code>dictionary</code> 타입으로 생성하고, <strong><code>과제III</code></strong> 에서 <code>code</code> 당 한번만 <code>fdr</code> 라이브러리를 사용하도록 바꾸어 준다.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><strong>과제 I</strong></p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><strong><code>과제I</code></strong> 은 앞의 방법과 같으므로 생략한다.</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s1">'상장일 2018-01-01 이전 종목코드: '</span><span class="p">,</span> <span class="n">lst_code</span><span class="p">[:</span><span class="mi">4</span><span class="p">])</span>
<span class="nb">print</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">'총 </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">df_code</span><span class="p">)</span><span class="si">}</span><span class="s1"> 개의 종목 중 </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">lst_code</span><span class="p">)</span><span class="si">}</span><span class="s1"> 개의 종목 선별'</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>상장일 2018-01-01 이전 종목코드:  ['000210', '004840', '155660', '078930']

총 2507 개의 종목 중 1977 개의 종목 선별
</pre>
</div>
</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><strong>과제 II</strong></p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">dict_code2date</span> <span class="o">=</span> <span class="p">{}</span>
<span class="k">for</span> <span class="n">code</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="n">lst_code</span><span class="p">):</span> 
    <span class="n">start_date</span> <span class="o">=</span> <span class="s1">'20180102'</span>
    <span class="n">end_date</span> <span class="o">=</span> <span class="s1">'20201231'</span>
    <span class="n">stock</span> <span class="o">=</span> <span class="n">fdr</span><span class="o">.</span><span class="n">DataReader</span><span class="p">(</span><span class="n">code</span><span class="p">,</span> <span class="n">start</span> <span class="o">=</span> <span class="n">start_date</span><span class="p">,</span> <span class="n">end</span> <span class="o">=</span> <span class="n">end_date</span><span class="p">)</span>
    <span class="n">stock</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>    
    
    <span class="c1"># 🌟 dataframe -&gt; list     </span>
    <span class="n">lst_stock</span> <span class="o">=</span> <span class="n">stock</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
    
    <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">lst_stock</span><span class="p">:</span> 
        <span class="n">date</span><span class="p">,</span> <span class="n">trading_value</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">row</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span><span class="o">*</span><span class="n">row</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">trading_value</span> <span class="o">&gt;=</span> <span class="mi">100000000000</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">code</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">dict_code2date</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="n">dict_code2date</span><span class="p">[</span><span class="n">code</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">date</span><span class="o">.</span><span class="n">date</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">"%Y%m</span><span class="si">%d</span><span class="s2">"</span><span class="p">)]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">dict_code2date</span><span class="p">[</span><span class="n">code</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">date</span><span class="o">.</span><span class="n">date</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">"%Y%m</span><span class="si">%d</span><span class="s2">"</span><span class="p">))</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">'총 </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">lst_code</span><span class="p">)</span><span class="si">}</span><span class="s1"> 개의 종목 중 </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">dict_code2date</span><span class="p">)</span><span class="si">}</span><span class="s1"> 개의 종목 사용'</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>100%|██████████████████████████████████████████████| 1977/1977 [02:42&lt;00:00, 12.14it/s]</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>총 1977 개의 종목 중 799 개의 종목 사용
</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>
</pre>
</div>
</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><strong>과제 III</strong></p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">OF</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s1">'assignment3.txt'</span><span class="p">,</span> <span class="s1">'w'</span><span class="p">)</span>
<span class="k">for</span> <span class="n">code</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="n">dict_code2date</span><span class="p">):</span> 
    <span class="c1"># code의 stock </span>
    <span class="n">start_date</span> <span class="o">=</span> <span class="s1">'20180101'</span> 
    <span class="n">end_date</span> <span class="o">=</span> <span class="s1">'20201231'</span> 
    <span class="n">stock</span> <span class="o">=</span> <span class="n">fdr</span><span class="o">.</span><span class="n">DataReader</span><span class="p">(</span><span class="n">code</span><span class="p">,</span> <span class="n">start</span> <span class="o">=</span> <span class="n">start_date</span><span class="p">,</span> <span class="n">end</span> <span class="o">=</span> <span class="n">end_date</span><span class="p">)</span>
    <span class="n">stock</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    
    <span class="c1"># 🌟 dataframe -&gt; list     </span>
    <span class="n">lst_stock</span> <span class="o">=</span> <span class="n">stock</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>  
       
    <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">lst_stock</span><span class="p">):</span>   
        <span class="k">if</span> <span class="p">(</span><span class="n">idx</span> <span class="o">&lt;</span> <span class="mi">9</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">idx</span> <span class="o">&gt;=</span> <span class="nb">len</span><span class="p">(</span><span class="n">lst_stock</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span> <span class="c1"># 예외 처리 </span>
            <span class="k">continue</span> 
        
        <span class="n">date</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">date</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">"%Y%m</span><span class="si">%d</span><span class="s2">"</span><span class="p">)</span> 
        <span class="k">if</span> <span class="n">date</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">dict_code2date</span><span class="p">[</span><span class="n">code</span><span class="p">]:</span> <span class="c1"># 조건에 부합하는 날짜 (D0 날짜)를 발견할 때까지 continue</span>
            <span class="k">continue</span> 

        <span class="c1"># D-9 ~ D0 데이터만 담기</span>
        <span class="n">sub_stock</span> <span class="o">=</span> <span class="n">lst_stock</span><span class="p">[</span><span class="n">idx</span><span class="o">-</span><span class="mi">9</span><span class="p">:</span><span class="n">idx</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> 
        
        <span class="c1"># 10일간의 데이터 </span>
        <span class="n">lst_info</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">row2</span> <span class="ow">in</span> <span class="n">sub_stock</span><span class="p">:</span>
            <span class="n">lst_prices</span><span class="p">,</span> <span class="n">trading_value</span> <span class="o">=</span> <span class="n">row2</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="mi">5</span><span class="p">],</span> <span class="n">row2</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span><span class="o">*</span><span class="n">row2</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span>
            <span class="n">lst_info</span> <span class="o">+=</span> <span class="n">lst_prices</span> <span class="o">+</span> <span class="p">[</span><span class="n">trading_value</span><span class="p">]</span>
        <span class="n">info</span> <span class="o">=</span> <span class="s1">','</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">lst_info</span><span class="p">))</span>

        <span class="c1"># D+1 종가 2% 상승 여부 </span>
        <span class="n">label</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">lst_stock</span><span class="p">[</span><span class="n">idx</span><span class="o">+</span><span class="mi">1</span><span class="p">][</span><span class="mi">6</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mf">0.02</span><span class="p">)</span>

        <span class="c1"># 저장 </span>
        <span class="n">OF</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s1">'</span><span class="si">{</span><span class="n">code</span><span class="si">}</span><span class="se">\t</span><span class="si">{</span><span class="n">date</span><span class="si">}</span><span class="se">\t</span><span class="si">{</span><span class="n">info</span><span class="si">}</span><span class="se">\t</span><span class="si">{</span><span class="n">label</span><span class="si">}</span><span class="se">\n</span><span class="s1">'</span><span class="p">)</span>
                         
<span class="n">OF</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>   

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">'생성된 데이터의 개수는 </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">"assignment3.txt"</span><span class="p">))</span><span class="si">}</span><span class="s1"> 개'</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>100%|████████████████████████████████████████████████| 799/799 [01:07&lt;00:00, 11.84it/s]</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>생성된 데이터의 개수는 13939 개
</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>
</pre>
</div>
</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>약 17분이 걸리던 시간이 1분으로 줄어들었다.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<hr>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="✔️-(3)-Finance-Data-Reader를-이용한-주가-데이터셋---MultiProcessing">
<a class="anchor" href="#%E2%9C%94%EF%B8%8F-(3)-Finance-Data-Reader%EB%A5%BC-%EC%9D%B4%EC%9A%A9%ED%95%9C-%EC%A3%BC%EA%B0%80-%EB%8D%B0%EC%9D%B4%ED%84%B0%EC%85%8B---MultiProcessing" aria-hidden="true"><span class="octicon octicon-link"></span></a>✔️ (3) Finance Data Reader를 이용한 주가 데이터셋 - <code>MultiProcessing</code><a class="anchor-link" href="#%E2%9C%94%EF%B8%8F-(3)-Finance-Data-Reader%EB%A5%BC-%EC%9D%B4%EC%9A%A9%ED%95%9C-%EC%A3%BC%EA%B0%80-%EB%8D%B0%EC%9D%B4%ED%84%B0%EC%85%8B---MultiProcessing"> </a>
</h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<ul>
<li>
<code>multi processing(다중 처리)</code>: 컴퓨터 시스템 한 대에 두개 이상의 중앙 처리 장치 (CPU) 를 이용하여 병렬처리하는 것 </li>
</ul>
<ul>
<li>
<code>python multi processing</code> 문서: <a href="https://docs.python.org/ko/3/library/multiprocessing.html">https://docs.python.org/ko/3/library/multiprocessing.html</a>.</li>
</ul>
<p><code>python</code>은 <code>multiprocessing</code> 라이브러리를 통해 다중 처리를 지원한다. 여러 개의 <code>코어</code>를 연산에 사용함으로써 많은 작업을 빠른 시간에 처리해줄 수 있다는 장점이 있다.</p>
<p><img src="/blog/images/copied_from_nb/./ghtop_images/multi_processing.png" alt="image.png">
[ <code>core=10</code>으로 설정하여 multi processing을 수행할 때 코어 사용 ]</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">time</span><span class="o">,</span> <span class="nn">os</span>
<span class="kn">from</span> <span class="nn">multiprocessing</span> <span class="kn">import</span> <span class="n">Pool</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><strong>과제 I</strong></p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><strong><code>과제I</code></strong> 은 앞의 방법과 같으므로 생략한다.</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s1">'상장일 2018-01-01 이전 종목코드: '</span><span class="p">,</span> <span class="n">lst_code</span><span class="p">[:</span><span class="mi">4</span><span class="p">])</span>
<span class="nb">print</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">'총 </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">df_code</span><span class="p">)</span><span class="si">}</span><span class="s1"> 개의 종목 중 </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">lst_code</span><span class="p">)</span><span class="si">}</span><span class="s1"> 개의 종목 선별'</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>상장일 2018-01-01 이전 종목코드:  ['000210', '004840', '155660', '078930']

총 2507 개의 종목 중 1977 개의 종목 선별
</pre>
</div>
</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><strong>과제 II</strong></p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<ul>
<li>
<code>multi processing</code>을 위한 함수 정의 </li>
</ul>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">make_lst_result</span><span class="p">(</span><span class="n">code</span><span class="p">):</span> 
    <span class="n">start_date</span> <span class="o">=</span> <span class="s1">'20180101'</span>
    <span class="n">end_date</span> <span class="o">=</span> <span class="s1">'20201231'</span>
    
    <span class="n">lst_date</span> <span class="o">=</span> <span class="p">[]</span>
    
    <span class="n">stock</span> <span class="o">=</span> <span class="n">fdr</span><span class="o">.</span><span class="n">DataReader</span><span class="p">(</span><span class="n">code</span><span class="p">,</span> <span class="n">start</span> <span class="o">=</span> <span class="n">start_date</span><span class="p">,</span> <span class="n">end</span> <span class="o">=</span> <span class="n">end_date</span><span class="p">)</span>
    <span class="n">stock</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
  
    <span class="c1"># 🌟 dataframe -&gt; list</span>
    <span class="n">lst_stock</span> <span class="o">=</span> <span class="n">stock</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
    
    <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">lst_stock</span><span class="p">:</span> 
        <span class="k">if</span> <span class="n">row</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">*</span> <span class="n">row</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mi">100000000000</span><span class="p">:</span> 
            <span class="n">lst_date</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">date</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">"%Y%m</span><span class="si">%d</span><span class="s2">"</span><span class="p">))</span>
        
    <span class="k">return</span> <span class="p">[</span><span class="n">code</span><span class="p">,</span> <span class="n">lst_date</span><span class="p">]</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<ul>
<li>
<code>multi processing</code> 수행</li>
</ul>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
<span class="n">num_cores</span> <span class="o">=</span> <span class="mi">10</span>
<span class="n">pool</span> <span class="o">=</span> <span class="n">Pool</span><span class="p">(</span><span class="n">num_cores</span><span class="p">)</span>
<span class="n">lst_code_date</span> <span class="o">=</span> <span class="n">pool</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">make_lst_result</span><span class="p">,</span> <span class="n">lst_code</span><span class="p">)</span>
<span class="n">pool</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
<span class="n">pool</span><span class="o">.</span><span class="n">join</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">start_time</span><span class="p">)</span> 
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>17.97966194152832
</pre>
</div>
</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>앞서 약 2분 40초 가 걸렸던 <strong><code>과제II</code></strong> 를 <code>multi processing</code>을 사용하여 17초대로 단축시켰다.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<ul>
<li>
<code>dictionary</code> 생성 </li>
</ul>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">dict_code2date</span> <span class="o">=</span> <span class="p">{}</span>

<span class="k">for</span> <span class="n">code</span><span class="p">,</span> <span class="n">lst_date</span>  <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="n">lst_code_date</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">lst_date</span> <span class="o">==</span> <span class="p">[]:</span>
        <span class="k">continue</span>
    <span class="n">dict_code2date</span><span class="p">[</span><span class="n">code</span><span class="p">]</span> <span class="o">=</span> <span class="n">lst_date</span>
            
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">'총 </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">lst_code</span><span class="p">)</span><span class="si">}</span><span class="s1"> 개의 종목 중 </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">dict_code2date</span><span class="p">)</span><span class="si">}</span><span class="s1"> 개의 종목 사용'</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>100%|█████████████████████████████████████████| 1977/1977 [00:00&lt;00:00, 1610124.08it/s]</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>총 1977 개의 종목 중 799 개의 종목 사용
</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>
</pre>
</div>
</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><strong>과제 III</strong></p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<ul>
<li>
<code>multi processing</code>을 위한 함수 정의 </li>
</ul>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">make_lst_result2</span><span class="p">(</span><span class="n">code</span><span class="p">):</span> 
    <span class="c1"># code의 stock </span>
    <span class="n">start_date</span> <span class="o">=</span> <span class="s1">'20180101'</span> 
    <span class="n">end_date</span> <span class="o">=</span> <span class="s1">'20201231'</span> 
    <span class="n">stock</span> <span class="o">=</span> <span class="n">fdr</span><span class="o">.</span><span class="n">DataReader</span><span class="p">(</span><span class="n">code</span><span class="p">,</span> <span class="n">start</span> <span class="o">=</span> <span class="n">start_date</span><span class="p">,</span> <span class="n">end</span> <span class="o">=</span> <span class="n">end_date</span><span class="p">)</span>
    <span class="n">stock</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    
    <span class="c1"># 🌟 dataframe -&gt; list     </span>
    <span class="n">lst_stock</span> <span class="o">=</span> <span class="n">stock</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>  
       
    <span class="n">lst_result</span> <span class="o">=</span> <span class="p">[]</span>
        
    <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">lst_stock</span><span class="p">):</span> 
        
        <span class="k">if</span> <span class="p">(</span><span class="n">idx</span> <span class="o">&lt;</span> <span class="mi">9</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">idx</span> <span class="o">&gt;=</span> <span class="nb">len</span><span class="p">(</span><span class="n">lst_stock</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span> <span class="c1"># 예외 처리 </span>
            <span class="k">continue</span> 
            
        <span class="n">date</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">date</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">"%Y%m</span><span class="si">%d</span><span class="s2">"</span><span class="p">)</span> 
        <span class="k">if</span> <span class="n">date</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">dict_code2date</span><span class="p">[</span><span class="n">code</span><span class="p">]:</span> <span class="c1"># 조건에 부합하는 날짜 (D0 날짜)를 발견할 때까지 continue</span>
            <span class="k">continue</span> 

        <span class="c1"># D-9 ~ D0 데이터만 담기</span>
        <span class="n">sub_stock</span> <span class="o">=</span> <span class="n">lst_stock</span><span class="p">[</span><span class="n">idx</span><span class="o">-</span><span class="mi">9</span><span class="p">:</span><span class="n">idx</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> 
        
        <span class="c1"># 10일간의 데이터 </span>
        <span class="n">lst_info</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">row2</span> <span class="ow">in</span> <span class="n">sub_stock</span><span class="p">:</span>
            <span class="n">lst_prices</span><span class="p">,</span> <span class="n">trading_value</span> <span class="o">=</span> <span class="n">row2</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="mi">5</span><span class="p">],</span> <span class="n">row2</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span><span class="o">*</span><span class="n">row2</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span>
            <span class="n">lst_info</span> <span class="o">+=</span> <span class="n">lst_prices</span> <span class="o">+</span> <span class="p">[</span><span class="n">trading_value</span><span class="p">]</span>
        <span class="n">info</span> <span class="o">=</span> <span class="s1">','</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">lst_info</span><span class="p">))</span>

        <span class="c1"># D+1 종가 2% 상승 여부 </span>
        <span class="n">label</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">lst_stock</span><span class="p">[</span><span class="n">idx</span><span class="o">+</span><span class="mi">1</span><span class="p">][</span><span class="mi">6</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mf">0.02</span><span class="p">)</span>
        
        <span class="n">lst_result</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">code</span><span class="p">,</span> <span class="n">date</span><span class="p">,</span> <span class="n">info</span><span class="p">,</span> <span class="n">label</span><span class="p">])</span>
        
    <span class="k">return</span> <span class="n">lst_result</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<ul>
<li>
<code>multi processing</code> 수행</li>
</ul>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
<span class="n">num_cores</span> <span class="o">=</span> <span class="mi">10</span>
<span class="n">pool</span> <span class="o">=</span> <span class="n">Pool</span><span class="p">(</span><span class="n">num_cores</span><span class="p">)</span>
<span class="n">lst_data</span> <span class="o">=</span> <span class="n">pool</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">make_lst_result2</span><span class="p">,</span> <span class="n">dict_code2date</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
<span class="n">pool</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
<span class="n">pool</span><span class="o">.</span><span class="n">join</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">start_time</span><span class="p">)</span> 
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>8.186521768569946
</pre>
</div>
</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>앞서 진행했던 방법에서 1분이 걸렸던 작업이 <code>multi processing</code>을 통하여 8초로 줄어들었다.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<ul>
<li>
<code>txt</code> 파일 생성 </li>
</ul>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">OF</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s2">"assignment3_multi_processing.txt"</span><span class="p">,</span> <span class="s1">'w'</span><span class="p">)</span>

<span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">lst_data</span><span class="p">:</span> 
    <span class="k">for</span> <span class="n">num</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">row</span><span class="p">)):</span> 
        <span class="n">OF</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">'</span><span class="se">\t</span><span class="s1">'</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">row</span><span class="p">[</span><span class="n">num</span><span class="p">]))</span> <span class="o">+</span> <span class="s1">'</span><span class="se">\n</span><span class="s1">'</span><span class="p">)</span>
        
<span class="n">OF</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">'생성된 데이터의 개수는 </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">"assignment3_multi_processing.txt"</span><span class="p">))</span><span class="si">}</span><span class="s1"> 개'</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>생성된 데이터의 개수는 13939 개
</pre>
</div>
</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<hr>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="✔️-(4)-Finance-Data-Reader를-이용한-주가-데이터셋---MySQL">
<a class="anchor" href="#%E2%9C%94%EF%B8%8F-(4)-Finance-Data-Reader%EB%A5%BC-%EC%9D%B4%EC%9A%A9%ED%95%9C-%EC%A3%BC%EA%B0%80-%EB%8D%B0%EC%9D%B4%ED%84%B0%EC%85%8B---MySQL" aria-hidden="true"><span class="octicon octicon-link"></span></a>✔️ <strong>(4)</strong> Finance Data Reader를 이용한 주가 데이터셋 - <code>MySQL</code><a class="anchor-link" href="#%E2%9C%94%EF%B8%8F-(4)-Finance-Data-Reader%EB%A5%BC-%EC%9D%B4%EC%9A%A9%ED%95%9C-%EC%A3%BC%EA%B0%80-%EB%8D%B0%EC%9D%B4%ED%84%B0%EC%85%8B---MySQL"> </a>
</h3>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>4번째 방법은 <code>MySQL</code>을 사용한다. 외부 데이터를 불러오지 않아도 되고, 서버 <code>DB</code>에 저장된 데이터를 불러오는 것이므로 <code>multi processing</code>을 사용하지 않고도 빠른 속도로 데이터셋을 생성할 수 있다.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><strong>과제 I</strong></p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>최종적으로 머신러닝 분석에 사용할 데이터셋은 코스피, 코스닥 시장에 해당하는 종목들만을 사용한다. 현재 <code>db</code>에 저장되어 있는 데이터도 코스피, 코스닥 시장에 해당하는 종목들이 입력되어 있으며, 해당 종목들을 추린 <code>code_list.txt</code>에서 종목들을 불러와 <code>lst_code</code>를 사용한다.</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">IF</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s1">'../data/code_list.txt'</span><span class="p">)</span>
<span class="n">lst_code</span> <span class="o">=</span> <span class="n">IF</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">'총 </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">df_code</span><span class="p">)</span><span class="si">}</span><span class="s1"> 개의 종목 중 </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">lst_code</span><span class="p">)</span><span class="si">}</span><span class="s1"> 개의 종목 선별'</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>총 2507 개의 종목 중 1561 개의 종목 선별
</pre>
</div>
</div>

</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># ! pip install pymysql</span>

<span class="kn">import</span> <span class="nn">pymysql</span> 
<span class="kn">from</span> <span class="nn">sqlalchemy</span> <span class="kn">import</span> <span class="n">create_engine</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<ul>
<li>
<strong><code>MySQL</code> 데이터 저장</strong> (<code>dataframe</code> -&gt; <code>sql</code>) <br>
</li>
</ul>
<p><code>code</code> 별로 다른 테이블에 저장한다.</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">db_connection_str</span> <span class="o">=</span> <span class="s1">'mysql+pymysql://[db username]:[db password]@[host address]/[db name]'</span> 
<span class="n">db_connection</span> <span class="o">=</span> <span class="n">create_engine</span><span class="p">(</span><span class="n">db_connection_str</span><span class="p">)</span>
<span class="n">conn</span> <span class="o">=</span> <span class="n">db_connection</span><span class="o">.</span><span class="n">connect</span><span class="p">()</span>

<span class="k">for</span> <span class="n">code</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="n">lst_code</span><span class="p">):</span> 
    <span class="n">start_date</span> <span class="o">=</span> <span class="s1">'20170101'</span>
    <span class="n">end_date</span> <span class="o">=</span> <span class="s1">'20211231'</span>
    <span class="n">stock</span> <span class="o">=</span> <span class="n">fdr</span><span class="o">.</span><span class="n">DataReader</span><span class="p">(</span><span class="n">code</span><span class="p">,</span> <span class="n">start</span> <span class="o">=</span> <span class="n">start_date</span><span class="p">,</span> <span class="n">end</span> <span class="o">=</span> <span class="n">end_date</span><span class="p">)</span>
    <span class="n">stock</span> <span class="o">=</span> <span class="n">stock</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
    <span class="n">stock</span> <span class="o">=</span> <span class="n">stock</span><span class="p">[[</span><span class="s1">'Date'</span><span class="p">,</span> <span class="s1">'Open'</span><span class="p">,</span> <span class="s1">'High'</span><span class="p">,</span> <span class="s1">'Low'</span><span class="p">,</span> <span class="s1">'Close'</span><span class="p">,</span> <span class="s1">'Volume'</span><span class="p">,</span> <span class="s1">'Change'</span><span class="p">]]</span>
    <span class="n">stock</span><span class="o">.</span><span class="n">to_sql</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="sa">f</span><span class="s1">'stock_</span><span class="si">{</span><span class="n">code</span><span class="si">}</span><span class="s1">'</span><span class="p">,</span> <span class="n">con</span><span class="o">=</span><span class="n">db_connection</span><span class="p">,</span> <span class="n">if_exists</span><span class="o">=</span><span class="s1">'fail'</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<ul>
<li>
<strong><code>MySQL</code> 에서 데이터 불러온 후 데이터셋 생성</strong> </li>
</ul>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">db_dsml</span> <span class="o">=</span> <span class="n">pymysql</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span>
    <span class="n">host</span> <span class="o">=</span> <span class="s1">'localhost'</span><span class="p">,</span> 
    <span class="n">port</span> <span class="o">=</span> <span class="mi">3306</span><span class="p">,</span> 
    <span class="n">user</span> <span class="o">=</span> <span class="s1">'[db username]'</span><span class="p">,</span> 
    <span class="n">passwd</span> <span class="o">=</span> <span class="s1">'[db password]'</span><span class="p">,</span> 
    <span class="n">db</span> <span class="o">=</span> <span class="s1">'[db name]'</span><span class="p">,</span> 
    <span class="n">charset</span> <span class="o">=</span> <span class="s1">'utf8'</span>
<span class="p">)</span>
<span class="n">cursor</span> <span class="o">=</span> <span class="n">db_dsml</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><strong>과제 II</strong></p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">dict_code2date</span> <span class="o">=</span> <span class="p">{}</span>
<span class="k">for</span> <span class="n">code</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="n">lst_code</span><span class="p">):</span> 
    <span class="n">code</span> <span class="o">=</span> <span class="n">code</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
    <span class="n">sql_query</span> <span class="o">=</span> <span class="s1">'''</span>
<span class="s1">                SELECT *</span>
<span class="s1">                FROM stock_</span><span class="si">{}</span><span class="s1"></span>
<span class="s1">                WHERE Date BETWEEN '2018-01-01' AND '2020-12-31'</span>
<span class="s1">                '''</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">code</span><span class="p">)</span>
    <span class="n">stock</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_sql</span><span class="p">(</span><span class="n">sql</span> <span class="o">=</span> <span class="n">sql_query</span><span class="p">,</span> <span class="n">con</span> <span class="o">=</span> <span class="n">db_dsml</span><span class="p">)</span>   
    
    <span class="c1"># 🌟 dataframe -&gt; list     </span>
    <span class="n">lst_stock</span> <span class="o">=</span> <span class="n">stock</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
    
    <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">lst_stock</span><span class="p">:</span> 
        <span class="n">date</span><span class="p">,</span> <span class="n">trading_value</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">row</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span><span class="o">*</span><span class="n">row</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">trading_value</span> <span class="o">&gt;=</span> <span class="mi">100000000000</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">code</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">dict_code2date</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="n">dict_code2date</span><span class="p">[</span><span class="n">code</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">date</span><span class="o">.</span><span class="n">date</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">"%Y%m</span><span class="si">%d</span><span class="s2">"</span><span class="p">)]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">dict_code2date</span><span class="p">[</span><span class="n">code</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">date</span><span class="o">.</span><span class="n">date</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">"%Y%m</span><span class="si">%d</span><span class="s2">"</span><span class="p">))</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">'총 </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">lst_code</span><span class="p">)</span><span class="si">}</span><span class="s1"> 개의 종목 중 </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">dict_code2date</span><span class="p">)</span><span class="si">}</span><span class="s1"> 개의 종목 사용'</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>100%|██████████████████████████████████████████████| 1561/1561 [00:22&lt;00:00, 69.07it/s]</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>총 1561 개의 종목 중 679 개의 종목 사용
</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>
</pre>
</div>
</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><strong>과제 III</strong></p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">OF</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s1">'assignment3_sql.txt'</span><span class="p">,</span> <span class="s1">'w'</span><span class="p">)</span>
<span class="k">for</span> <span class="n">code</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="n">dict_code2date</span><span class="p">):</span> 
    <span class="n">code</span> <span class="o">=</span> <span class="n">code</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
    <span class="n">sql_query</span> <span class="o">=</span> <span class="s1">'''</span>
<span class="s1">                SELECT *</span>
<span class="s1">                FROM stock_</span><span class="si">{}</span><span class="s1"></span>
<span class="s1">                WHERE Date BETWEEN '2018-01-01' AND '2020-12-31'</span>
<span class="s1">                '''</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">code</span><span class="p">)</span>
    <span class="n">stock</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_sql</span><span class="p">(</span><span class="n">sql</span> <span class="o">=</span> <span class="n">sql_query</span><span class="p">,</span> <span class="n">con</span> <span class="o">=</span> <span class="n">db_dsml</span><span class="p">)</span>  
    
    <span class="c1"># 🌟 dataframe -&gt; list     </span>
    <span class="n">lst_stock</span> <span class="o">=</span> <span class="n">stock</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>  
       
    <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">lst_stock</span><span class="p">):</span>   
        <span class="k">if</span> <span class="p">(</span><span class="n">idx</span> <span class="o">&lt;</span> <span class="mi">9</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">idx</span> <span class="o">&gt;=</span> <span class="nb">len</span><span class="p">(</span><span class="n">lst_stock</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span> <span class="c1"># 예외 처리 </span>
            <span class="k">continue</span> 
        
        <span class="n">date</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">date</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">"%Y%m</span><span class="si">%d</span><span class="s2">"</span><span class="p">)</span> 
        <span class="k">if</span> <span class="n">date</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">dict_code2date</span><span class="p">[</span><span class="n">code</span><span class="p">]:</span> <span class="c1"># 조건에 부합하는 날짜 (D0 날짜)를 발견할 때까지 continue</span>
            <span class="k">continue</span> 

        <span class="c1"># D-9 ~ D0 데이터만 담기</span>
        <span class="n">sub_stock</span> <span class="o">=</span> <span class="n">lst_stock</span><span class="p">[</span><span class="n">idx</span><span class="o">-</span><span class="mi">9</span><span class="p">:</span><span class="n">idx</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> 
        
        <span class="c1"># 10일간의 데이터 </span>
        <span class="n">lst_info</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">row2</span> <span class="ow">in</span> <span class="n">sub_stock</span><span class="p">:</span>
            <span class="n">lst_prices</span><span class="p">,</span> <span class="n">trading_value</span> <span class="o">=</span> <span class="n">row2</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="mi">5</span><span class="p">],</span> <span class="n">row2</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span><span class="o">*</span><span class="n">row2</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span>
            <span class="n">lst_info</span> <span class="o">+=</span> <span class="n">lst_prices</span> <span class="o">+</span> <span class="p">[</span><span class="n">trading_value</span><span class="p">]</span>
        <span class="n">info</span> <span class="o">=</span> <span class="s1">','</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">lst_info</span><span class="p">))</span>

        <span class="c1"># D+1 종가 2% 상승 여부 </span>
        <span class="n">label</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">lst_stock</span><span class="p">[</span><span class="n">idx</span><span class="o">+</span><span class="mi">1</span><span class="p">][</span><span class="mi">6</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mf">0.02</span><span class="p">)</span>

        <span class="c1"># 저장 </span>
        <span class="n">OF</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s1">'</span><span class="si">{</span><span class="n">code</span><span class="si">}</span><span class="se">\t</span><span class="si">{</span><span class="n">date</span><span class="si">}</span><span class="se">\t</span><span class="si">{</span><span class="n">info</span><span class="si">}</span><span class="se">\t</span><span class="si">{</span><span class="n">label</span><span class="si">}</span><span class="se">\n</span><span class="s1">'</span><span class="p">)</span>
                         
<span class="n">OF</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>   

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">'생성된 데이터의 개수는 </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">"assignment3_sql.txt"</span><span class="p">))</span><span class="si">}</span><span class="s1"> 개'</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>100%|████████████████████████████████████████████████| 679/679 [00:11&lt;00:00, 61.46it/s]</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>생성된 데이터의 개수는 11934 개
</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>
</pre>
</div>
</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<hr>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="✔️-(5)-최종-머신러닝-데이터셋">
<a class="anchor" href="#%E2%9C%94%EF%B8%8F-(5)-%EC%B5%9C%EC%A2%85-%EB%A8%B8%EC%8B%A0%EB%9F%AC%EB%8B%9D-%EB%8D%B0%EC%9D%B4%ED%84%B0%EC%85%8B" aria-hidden="true"><span class="octicon octicon-link"></span></a>✔️ <strong>(5)</strong> 최종 머신러닝 데이터셋<a class="anchor-link" href="#%E2%9C%94%EF%B8%8F-(5)-%EC%B5%9C%EC%A2%85-%EB%A8%B8%EC%8B%A0%EB%9F%AC%EB%8B%9D-%EB%8D%B0%EC%9D%B4%ED%84%B0%EC%85%8B"> </a>
</h3>
<p>최종적으로 생성된 머신러닝 데이터셋의 형태를 확인한다.</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">IF</span><span class="o">=</span><span class="nb">open</span><span class="p">(</span><span class="s2">"assignment3_sql.txt"</span><span class="p">,</span><span class="s1">'r'</span><span class="p">)</span>
<span class="n">lst_code_date</span><span class="o">=</span><span class="p">[]</span>
<span class="n">trainX</span><span class="o">=</span><span class="p">[]</span>
<span class="n">trainY</span><span class="o">=</span><span class="p">[]</span>
<span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">IF</span><span class="p">:</span>
    <span class="n">code</span><span class="p">,</span> <span class="n">date</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">"</span><span class="se">\t</span><span class="s2">"</span><span class="p">)</span>
    <span class="n">lst_code_date</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">code</span><span class="p">,</span> <span class="n">date</span><span class="p">])</span>
    <span class="n">trainX</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="n">x</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">","</span><span class="p">))))</span>
    <span class="n">trainY</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">y</span><span class="p">))</span>
<span class="n">trainX</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">trainX</span><span class="p">)</span>
<span class="n">trainY</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">trainY</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s2">"===== trainX ====="</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">"trainX shape:"</span><span class="p">,</span> <span class="n">trainX</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="n">display</span><span class="p">(</span><span class="n">trainX</span><span class="o">.</span><span class="n">head</span><span class="p">())</span>
<span class="nb">print</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">"===== trainY ====="</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">"trainY shape:"</span><span class="p">,</span> <span class="n">trainY</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="n">display</span><span class="p">(</span><span class="n">trainY</span><span class="o">.</span><span class="n">head</span><span class="p">())</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>===== trainX =====
trainX shape: (11935, 50)
</pre>
</div>
</div>

<div class="output_area">


<div class="output_html rendered_html output_subarea ">
<div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>0</th>
      <th>1</th>
      <th>2</th>
      <th>3</th>
      <th>4</th>
      <th>5</th>
      <th>6</th>
      <th>7</th>
      <th>8</th>
      <th>9</th>
      <th>...</th>
      <th>40</th>
      <th>41</th>
      <th>42</th>
      <th>43</th>
      <th>44</th>
      <th>45</th>
      <th>46</th>
      <th>47</th>
      <th>48</th>
      <th>49</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>10250</td>
      <td>12050</td>
      <td>10150</td>
      <td>11800</td>
      <td>307823874200</td>
      <td>11950</td>
      <td>12450</td>
      <td>10900</td>
      <td>11750</td>
      <td>240410569500</td>
      <td>...</td>
      <td>15300</td>
      <td>15400</td>
      <td>12650</td>
      <td>13700</td>
      <td>789063638200</td>
      <td>13700</td>
      <td>16100</td>
      <td>13400</td>
      <td>15400</td>
      <td>897154258000</td>
    </tr>
    <tr>
      <th>1</th>
      <td>11950</td>
      <td>12450</td>
      <td>10900</td>
      <td>11750</td>
      <td>240410569500</td>
      <td>11850</td>
      <td>14150</td>
      <td>11600</td>
      <td>12600</td>
      <td>764364560400</td>
      <td>...</td>
      <td>13700</td>
      <td>16100</td>
      <td>13400</td>
      <td>15400</td>
      <td>897154258000</td>
      <td>14700</td>
      <td>15500</td>
      <td>14000</td>
      <td>14350</td>
      <td>277027065700</td>
    </tr>
    <tr>
      <th>2</th>
      <td>11850</td>
      <td>14150</td>
      <td>11600</td>
      <td>12600</td>
      <td>764364560400</td>
      <td>12800</td>
      <td>13200</td>
      <td>12000</td>
      <td>12200</td>
      <td>170010147600</td>
      <td>...</td>
      <td>14700</td>
      <td>15500</td>
      <td>14000</td>
      <td>14350</td>
      <td>277027065700</td>
      <td>13050</td>
      <td>13300</td>
      <td>11650</td>
      <td>11650</td>
      <td>231873876050</td>
    </tr>
    <tr>
      <th>3</th>
      <td>12800</td>
      <td>13200</td>
      <td>12000</td>
      <td>12200</td>
      <td>170010147600</td>
      <td>12450</td>
      <td>13400</td>
      <td>12350</td>
      <td>12850</td>
      <td>211661434950</td>
      <td>...</td>
      <td>13050</td>
      <td>13300</td>
      <td>11650</td>
      <td>11650</td>
      <td>231873876050</td>
      <td>12200</td>
      <td>13150</td>
      <td>11600</td>
      <td>12200</td>
      <td>222393934200</td>
    </tr>
    <tr>
      <th>4</th>
      <td>12450</td>
      <td>13400</td>
      <td>12350</td>
      <td>12850</td>
      <td>211661434950</td>
      <td>12800</td>
      <td>12950</td>
      <td>11300</td>
      <td>11700</td>
      <td>91801277100</td>
      <td>...</td>
      <td>12200</td>
      <td>13150</td>
      <td>11600</td>
      <td>12200</td>
      <td>222393934200</td>
      <td>12200</td>
      <td>13750</td>
      <td>12100</td>
      <td>12350</td>
      <td>256196958550</td>
    </tr>
  </tbody>
</table>
<p>5 rows × 50 columns</p>
</div>
</div>

</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>
===== trainY =====
trainY shape: (11935, 1)
</pre>
</div>
</div>

<div class="output_area">


<div class="output_html rendered_html output_subarea ">
<div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>0</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>1</td>
    </tr>
    <tr>
      <th>3</th>
      <td>0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>1</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<ul>
<li>
<code>kospi</code> + <code>kosdaq</code> 주식 시장, <code>3년</code> 이상 존속하였던 종목들을 거래대금 <code>1000억</code> 이상의 조건으로 설정하고, <code>10일</code> 간의 데이터들을 <code>feature</code>로 두어 생성한 최종 머신러닝 데이터셋은 <code>11935</code> X <code>50</code> 의 크기가 나왔다. </li>
</ul>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<hr>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>4단계의 과정을 거쳐 머신러닝 데이터셋 생성을 마쳤다. 다음 글에서는 생성된 머신러닝 데이터셋을 사용하여 여러 머신러닝 모델을 학습 및 평가하여 성능이 가장 좋은 모델을 선정하는 <code>baseline model selection</code>을 진행한다.</p>

</div>
</div>
</div>
</div>



  </div><!-- from https://github.com/utterance/utterances -->
<script src="https://utteranc.es/client.js"
        repo="eunsukim06/blog"
        issue-term="title"
        label="blogpost-comment"
        theme="github-light"
        crossorigin="anonymous"
        async>
</script><a class="u-url" href="/blog/stock%20prediction/2022/07/07/stock-dataset.html" hidden></a>
</article>

      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/blog/"></data>

  <div class="wrapper">

    <div class="footer-col-wrapper">
      <div class="footer-col">
        <p class="feed-subscribe">
          <a href="/blog/feed.xml">
            <svg class="svg-icon orange">
              <use xlink:href="/blog/assets/minima-social-icons.svg#rss"></use>
            </svg><span>Subscribe</span>
          </a>
        </p>
      </div>
      <div class="footer-col">
        <p>An easy to use blogging platform with support for Jupyter Notebooks.</p>
      </div>
    </div>

    <div class="social-links"><ul class="social-media-list"><li><a rel="me" href="https://github.com/fastai" target="_blank" title="fastai"><svg class="svg-icon grey"><use xlink:href="/blog/assets/minima-social-icons.svg#github"></use></svg></a></li><li><a rel="me" href="https://twitter.com/fastdotai" target="_blank" title="fastdotai"><svg class="svg-icon grey"><use xlink:href="/blog/assets/minima-social-icons.svg#twitter"></use></svg></a></li></ul>
</div>

  </div>

</footer>
</body>

</html>
